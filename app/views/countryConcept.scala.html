@(rs: es.weso.wfLodPortal.models.ResultQuery, options: scala.collection.mutable.Map[String, Object])(implicit request: RequestHeader)

@import es.weso.wfLodPortal.models._
@import es.weso.wfLodPortal.sparql.Handlers._
@import es.weso.wfLodPortal.utils.CommonURIS._

@import views.html.helpers._
@import views.helpers.Utils._
@import views.helpers.wf.Utils._

@loadCountries = @{ 
  var countries = scala.collection.mutable.Map[String,Tuple2[String, String]]()
	
  for(country <- rs.predicate.get.get(rdf, "type").get.nodes) {
    country.asRdfResource match {
      case Some(r) =>
        val countryLabel:String= cachedLabel(r)
        val uri = r.uri.relative
		countries(countryLabel) = (iso2(r.dss), uri)
	  case None => {}
	  } 
	}
	
	countries.toList.sorted
}

@main(None, options("mode").toString) {
	@defining(loadCountries){ countries =>
	<nav class="breadcrumbs">
		@data(options) &gt; Country
	</nav>
	<h1>@label(rs)</h1>
	<h2><a href="@rdfType(rs)">@rdfTypeLabel(rs)</a></h2>	
	
	<div id="countryName" class="country-name"></div>
	<div id="world-map" class="country-concept-map"></div>
	<nav class="country-list">
		@for(country <- countries) {
			<a class="country" href="@country._2._2" code="@country._2._1">@country._1</a>
		}
	</nav>
	
	@subjectGrill(rs)
	@sparqlQuery(options)

	<script src="@routes.Assets.at("javascripts/jvectormap.js")"></script>
	<script src="@routes.Assets.at("javascripts/map.js")"></script>	
	<script>
		var countryCodes = {};
		var countries = {};
		
		@for(country <- countries) {	
			countryCodes["@country._2._1"] = {
												uri: "@country._2._2",
												name: "@country._1"
											 };
			
			countries["@country._2._1"]  = 1;
		}
		
		$('#world-map').vectorMap({
			map: 'world_merc_en',
			backgroundColor: "#fff",
			series: {
		    	regions: [{
			    	values: countries,
			    	scale: ['#C8EEFF', '#0071A4'],
			    	normalizeFunction: 'polynomial'
			    }]
			},
			zoomOnScroll: false,
		    
		    onRegionLabelShow: function(e, el, code) {
		    	$("#countryName").html(countryCodes[code].name);
			},
			
			onRegionOut: function(e, code) {
				$("#countryName").html("");
			},
		    
		    onRegionClick: function(e, code) {
		    	var uri = countryCodes[code].uri;

		    	if (uri)
				    window.location.href = uri;
		    }
		});
	</script>
	}
}